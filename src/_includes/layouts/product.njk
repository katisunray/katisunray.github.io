---
layout: layouts/base.njk
---
{% set schema_product = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: title,
  image: images | pluck('src'),
  description: seo and seo.description or content | striptags | truncate(160),
  offers: {
    '@type': 'Offer',
    price: price,
    priceCurrency: currency or 'CAD',
    availability: in_stock and 'https://schema.org/InStock' or 'https://schema.org/OutOfStock',
    url: buy_url
  }
} %}

<article class="py-10">
  <div class="container-custom">
    <a href="{{ '/shop/' | url }}" class="btn-secondary inline-flex items-center gap-1 px-4 py-2 text-sm">‚Üê Back to Shop</a>
    <h1 class="mt-2 text-3xl md:text-4xl font-semibold tracking-tight">{{ title }}</h1>
    {% set gallery = images | filterDetailImages %}
    <div class="mt-8 grid md:grid-cols-2 gap-10 lg:gap-16 items-start">
      <div>
        {% if gallery and gallery.length %}
          {% set primary = gallery[0] %}
        <div class="mb-4 max-w-xl">{% img primary.src, title %}</div>
        {% if gallery.length > 1 %}
          <div class="grid grid-cols-3 sm:grid-cols-4 gap-3 max-w-xl">
            {% for image in gallery %}
              {% if not loop.first %}
                <div class="border rounded overflow-hidden">{% img image.src, title, [300,600] %}</div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      {% endif %}
      </div>
      <div>
      <div class="text-lg leading-relaxed space-y-4 max-w-prose">{{ content | safe }}</div>
      {% set hasPrice = price is defined and price != null and price != '' %}
      {% if price_label %}
        <p class="mt-6 text-xl font-semibold">{{ price_label }}</p>
      {% elseif hasPrice %}
        <p class="mt-6 text-xl"><span class="font-semibold">{{ price }}</span> {{ currency or 'CAD' }}</p>
      {% endif %}
      {% if in_stock %}
        <div class="mt-1 text-sm text-green-700">In stock</div>
      {% endif %}
      {% if buy_url %}
        {% set buyLabel = buy_button_label or 'Buy' %}
        {% set lowerUrl = buy_url | lower %}
        {% if not buy_button_label and lowerUrl and (lowerUrl | startsWith('mailto:')) %}
          {% set buyLabel = 'Order by Email' %}
        {% endif %}
        <a href="{{ buy_url }}" class="btn-primary inline-block mt-4">{{ buyLabel }}</a>
      {% endif %}
      {% if type %}
        <div class="mt-4 inline-block text-xs uppercase tracking-wide bg-beige px-2 py-1 rounded-md">{{ type }}</div>
      {% endif %}
      </div>
    </div>

    {% set linkedCollections = collections.productCollections | filterByData('parent_product_slug', slug) | sortByData('order') %}
    {% if linkedCollections | length %}
      <section class="mt-16 border-t border-gray-200 pt-10">
        <h2 class="text-2xl md:text-3xl font-semibold tracking-tight">Collections</h2>
        {% if collection_order_prompt %}
          <p class="mt-3 text-base leading-relaxed text-slate-700 max-w-2xl">{{ collection_order_prompt }}</p>
        {% endif %}
        <div class="mt-10 grid gap-8 md:grid-cols-2">
          {% for collection in linkedCollections %}
            <a href="{{ collection.url }}" class="group block border rounded-xl overflow-hidden bg-white hover:shadow-lg transition-shadow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-600">
              {% if collection.data.hero_image and collection.data.hero_image.src %}
                <div class="aspect-[4/3] bg-gray-100 overflow-hidden media-contain">
                  {% img collection.data.hero_image.src, collection.data.hero_image.alt or ('Preview of ' ~ collection.data.title), [640, 960, 1280], '(min-width: 1024px) 40vw, 100vw' %}
                </div>
              {% endif %}
              <div class="p-6 space-y-3">
                <h3 class="text-xl font-semibold tracking-tight group-hover:underline">{{ collection.data.title }}</h3>
                {% if collection.data.summary %}
                  <p class="text-sm leading-relaxed text-slate-600">{{ collection.data.summary }}</p>
                {% endif %}
                <span class="inline-flex items-center gap-2 text-sm font-medium text-slate-700 group-hover:text-slate-900">View SKUs &rarr;</span>
              </div>
            </a>
          {% endfor %}
        </div>
      </section>
    {% elseif collection_sets and collection_sets.length %}
      {% set orderEmail = site and site.author and site.author.email or 'katisunray@gmail.com' %}
      <section class="mt-16 border-t border-gray-200 pt-10">
        <h2 class="text-2xl md:text-3xl font-semibold tracking-tight">Collections</h2>
        {% if collection_order_prompt %}
          <p class="mt-3 text-base leading-relaxed text-slate-700 max-w-2xl">{{ collection_order_prompt }}</p>
        {% endif %}
        <div class="mt-10 space-y-16">
          {% for collection in collection_sets %}
            <div {% if collection.slug %}id="collection-{{ collection.slug }}"{% endif %}>
              <div class="md:flex md:items-center md:gap-10">
                {% if collection.hero_image and collection.hero_image.src %}
                  <div class="md:w-2/5 lg:w-[45%] rounded-lg overflow-hidden border bg-gray-50">
                    {% img collection.hero_image.src, collection.hero_image.alt or ('Preview of ' ~ collection.title), [640, 960, 1280], '(min-width: 1024px) 40vw, 100vw' %}
                  </div>
                {% endif %}
                <div class="mt-6 md:mt-0 md:flex-1">
                  <h3 class="text-xl md:text-2xl font-semibold tracking-tight">{{ collection.title }}</h3>
                  {% if collection.summary %}
                    <p class="mt-3 text-base leading-relaxed text-slate-700 max-w-prose">{{ collection.summary }}</p>
                  {% endif %}
                </div>
              </div>

              {% if collection.skus and collection.skus.length %}
                <div class="mt-8 grid gap-8 sm:grid-cols-2 lg:grid-cols-2">
                  {% for sku in collection.skus %}
                    <div class="flex flex-col border rounded-lg overflow-hidden bg-white hover:shadow-md transition-shadow">
                      {% if sku.image and sku.image.src %}
                        <div class="bg-gray-50">
                          {% img sku.image.src, sku.image.alt or (sku.name or sku.id), [360, 600, 840], '(min-width: 1280px) 22vw, (min-width: 768px) 45vw, 100vw' %}
                        </div>
                      {% endif %}
                      <div class="p-4 flex flex-col gap-2 flex-1">
                        <p class="text-xs font-semibold tracking-wide text-slate-600 uppercase">SKU {{ sku.id }}</p>
                        {% if sku.name %}
                          <p class="text-base font-medium">{{ sku.name }}</p>
                        {% endif %}
                        {% set skuPrice = sku.price or price %}
                        {% set skuCurrency = sku.currency or currency or 'CAD' %}
                        {% if skuPrice %}
                          <p class="text-sm font-semibold text-brand-600">${{ skuPrice }} {{ skuCurrency }}</p>
                        {% endif %}
                        {% if sku.message %}
                          <p class="text-sm text-slate-600">{{ sku.message }}</p>
                        {% endif %}
                        {% if sku.description %}
                          <p class="text-sm text-slate-600 leading-relaxed">{{ sku.description }}</p>
                        {% endif %}
                        <div class="mt-auto pt-4 border-t border-gray-200">
                          {% set subject = ('Greeting Card Order - SKU ' ~ sku.id) | encodeURIComponent %}
                          {% set bodyText %}
Hi Kati,

I would like to order SKU {{ sku.id }} (Quantity: ___).
Price: ${{ skuPrice }} {{ skuCurrency }}

Thank you!
                          {% endset %}
                          {% set body = bodyText | trim | encodeURIComponent %}
                          <a href="mailto:{{ orderEmail }}?subject={{ subject }}&body={{ body }}" class="btn-primary inline-flex items-center gap-2 mt-3">Order by Email</a>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </div>
</article>

